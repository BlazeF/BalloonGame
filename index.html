<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<style>
body{
    background:white;
    color:black;
    font-family:Arial;
    text-align:center;
}

#arena{
    width:520px;
    height:520px;
    border-radius:50%;
    border:3px solid #333;
    margin:10px auto;
    position:relative;
    overflow:hidden;
}

/* BUTTONS */
button{
    padding:10px 22px;
    font-size:16px;
    cursor:pointer;
    margin:5px;
}

/* MOBILE CONTROL BUTTONS */
#controls{
    margin:10px auto;
}

/* BALLOON SHAPE */
.balloon{
    width:34px;
    height:46px;
    border-radius:50% 50% 45% 45%;
    position:absolute;
    opacity:0;
    animation:fade 2.2s linear forwards;
    transform:rotate(var(--rot));
}

.balloon::after{
    content:"";
    position:absolute;
    width:2px;
    height:14px;
    background:#aaa;
    left:50%;
    top:44px;
}

/* COLORS */
.red{background:red}
.green{background:green}
.yellow{background:gold}
.blue{background:deepskyblue}
.pink{background:hotpink}

@keyframes fade{
    0%{opacity:0}
    15%{opacity:1}
    80%{opacity:1}
    100%{opacity:0}
}
</style>
</head>

<body>

<p>
<b>H</b> â†’ Yellow ðŸŸ¡ â†’ Red ðŸ”´ â†’ Green ðŸŸ¢ |
ðŸŽˆðŸŽˆðŸŽˆðŸŽˆðŸŽˆ <b>L</b> â†’ Exactly 5 same-color balloons
</p>

<button id="startBtn">â–¶ Start Game</button>

<h3>
Score: <span id="score">0</span> |
Wrong: <span id="wrong">0</span> |
Missed: <span id="missed">0</span>
</h3>

<div id="arena"></div>

<div id="controls">
    <button id="btnH">H</button>
    <button id="btnL">L</button>
</div>

<script>
/* ---------- STATE ---------- */
const arena = document.getElementById("arena");
const scoreEl = document.getElementById("score");
const wrongEl = document.getElementById("wrong");
const missedEl = document.getElementById("missed");

let score = 0, wrong = 0, missed = 0;
let lock = false;
let gameStarted = false;

const colors = ["red","green","yellow","blue","pink"];

/* ---------- HELPERS ---------- */
function updateUI(){
    scoreEl.innerText = score;
    wrongEl.innerText = wrong;
    missedEl.innerText = missed;
}

function rand(min,max){
    return Math.random() * (max - min) + min;
}

/* ---------- SPAWN BALLOON ---------- */
function spawn(color,x,y){
    const b = document.createElement("div");
    b.className = `balloon ${color}`;
    b.style.left = x + "px";
    b.style.top = y + "px";
    b.style.setProperty("--rot", rand(-12,12) + "deg");
    arena.appendChild(b);
    setTimeout(()=>b.remove(),3400);
}

/* ---------- DISTRACTIONS ---------- */
function startDistractions(){
    setInterval(()=>{
        if(Math.random() < 0.75){
            spawn(
                colors[Math.floor(Math.random()*colors.length)],
                rand(20,480),
                rand(20,480)
            );
        }
    }, 1700);
}

/* ---------- GAME 1 : SEQUENCE (H) ---------- */
let expectingSequence = false;

function sequenceGame(){
    if(lock) return;
    lock = true;
    expectingSequence = false;

    const valid = Math.random() < 0.7;
    const seq = valid
        ? ["yellow","red","green"]
        : [...colors].sort(()=>Math.random()-0.5).slice(0,3);

    let i = 0;
    const intv = setInterval(()=>{
        spawn(seq[i], rand(170,330), rand(170,330));
        i++;
        if(i === 3){
            clearInterval(intv);
            if(valid) expectingSequence = true;

            setTimeout(()=>{
                if(expectingSequence){
                    missed++;
                    expectingSequence = false;
                    updateUI();
                }
                lock = false;
            }, 1700);
        }
    }, 800);
}

/* ---------- GAME 2 : CLUSTER (L) ---------- */
let expectingCluster = false;

function clusterGame(){
    if(lock) return;
    lock = true;
    expectingCluster = false;

    const counts = [4,5,5,5,6,7];
    const count = counts[Math.floor(Math.random()*counts.length)];
    const valid = count === 5;

    const color = colors[Math.floor(Math.random()*colors.length)];
    const cx = rand(200,320);
    const cy = rand(200,320);
    const radius = 38;

    for(let i=0;i<count;i++){
        const a = (2*Math.PI/count)*i;
        spawn(
            color,
            cx + Math.cos(a)*radius + rand(-4,4),
            cy + Math.sin(a)*radius + rand(-4,4)
        );
    }

    if(valid) expectingCluster = true;

    setTimeout(()=>{
        if(expectingCluster){
            missed++;
            expectingCluster = false;
            updateUI();
        }
        lock = false;
    }, 2200);
}

/* ---------- MAIN LOOP ---------- */
function startMainLoop(){
    setInterval(()=>{
        Math.random() < 0.55 ? sequenceGame() : clusterGame();
    }, 2400);
}

/* ---------- INPUT ---------- */
function handleInput(key){
    if(!gameStarted) return;

    // H â†’ Sequence
    if(key === "H"){
        if(expectingSequence){
            score++;
            expectingSequence = false;
        } else {
            wrong++;
        }
        updateUI();
    }

    // L â†’ Cluster
    if(key === "L"){
        if(expectingCluster){
            score++;
            expectingCluster = false;
        } else {
            wrong++;
        }
        updateUI();
    }
}

document.addEventListener("keydown", e=>{
    handleInput(e.key.toUpperCase());
});

document.getElementById("btnH").onclick = ()=>handleInput("H");
document.getElementById("btnL").onclick = ()=>handleInput("L");

/* ---------- START ---------- */
document.getElementById("startBtn").onclick = ()=>{
    if(gameStarted) return;
    gameStarted = true;

    score = wrong = missed = 0;
    updateUI();

    startDistractions();
    startMainLoop();

    const btn = document.getElementById("startBtn");
    btn.innerText = "Game Runningâ€¦";
    btn.disabled = true;
};
</script>

</body>
</html>
